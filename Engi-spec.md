# NFR Table – Vault Agent, Venafi PKI Engine & Venafi TPP

| Requirement            | Type                     | Description                                                                                                                                   | Measure                                                                 |
|------------------------|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
| **Certificate Issuance** | Availability / Performance | Venafi TPP generates certificates and key pairs. Vault Venafi PKI engine requests issuance and stores the cert/metadata in Vault. Vault Agent only fetches and injects into workloads. | SLA of Venafi TPP API ≥ 99.9% uptime. Latency ≤ 2s per issuance. Vault must persist cert until renewal. |
| **Storage**            | Security / Compliance    | Vault stores issued certs and metadata (lease, TTL) to avoid re-issuance. Private keys may also be stored depending on configuration. Vault Agent never persists, only injects. TPP stores lifecycle metadata. | Certs stored in Vault’s storage backend (encrypted). No certs/keys at rest on Vault Agent. Compliance checked via Vault audit logs. |
| **Renewal**            | Availability / Reliability | Vault Venafi PKI engine handles auto-renewal before expiry using stored lease info. Vault Agent auto-fetches the renewed cert for workloads. No need to re-issue until expiry. | Auto-renew threshold ~2/3rd of cert lifetime. Renewal success rate ≥ 99%. |
| **Expiry Handling**    | Reliability              | Venafi TPP enforces validity periods. Vault tracks TTL and requests renewal before expiry. Expired certs are replaced with new issuance via TPP. | Alerts/logs for expiry within threshold (e.g., 7 days). No expired certs injected. |
| **Revocation**         | Security / Compliance    | Revocation is executed via Venafi TPP. Vault Venafi PKI engine can trigger revocation through TPP APIs. Revoked certs appear in CRL/OCSP. Vault ensures revoked certs are not injected. | Revocation SLA ≤ 2s. Revoked cert visible in CRL/OCSP ≤ 15 min. Vault must reject revoked certs. |


Vault = broker + cache/storage

Vault Agent = injector only

Venafi TPP = issuer + system of record

| **ID**      | **Domain**                     | **Requirement Description**                                                                                                        | **Rationale / Compliance Objective**                      | **Measure / Validation Criteria**                                                                                    |
| :---------- | :----------------------------- | :--------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------- |
| **NFR-DR1** | Data Protection at Rest        | All Vault-stored sensitive data (certificates, tokens, metadata) must be encrypted at rest using **AES-256-GCM or stronger**.      | Protects against disk compromise and unauthorized access. | Verify Vault storage encryption settings; check encryption cipher in config file or via `vault operator key-status`. |
| **NFR-DR2** | Data Protection at Rest        | Vault’s storage backend must use **auto-unseal with HSM or cloud KMS**; master keys must never be stored in plaintext.             | Ensures cryptographic key protection during startup.      | Validate HSM/KMS integration via Vault config; review unseal process and audit logs.                                 |
| **NFR-DR3** | Data Protection at Rest        | Venafi TPP must store private keys in its **secure keystore / HSM**; plaintext storage is prohibited.                              | Maintains confidentiality of private keys.                | Review Venafi key storage configuration and HSM integration reports.                                                 |
| **NFR-DR4** | Data Protection at Rest        | Vault data storage nodes must be protected via **RBAC and network segmentation**.                                                  | Reduces insider and lateral-movement risks.               | Validate network ACLs and user access lists; perform periodic access audits.                                         |
| **NFR-DR5** | Data Protection at Rest        | Backups of Vault and Venafi data must be encrypted using enterprise-approved algorithms.                                           | Preserves data confidentiality in archives.               | Check backup encryption configuration and verify restore sample with encryption intact.                              |
| **NFR-DT1** | Data Protection in Transit     | All communication between Vault Agent ↔ Vault Server ↔ Venafi TPP must use **mutual TLS (mTLS)**.                                  | Prevents MITM and spoofing attacks.                       | Validate certificates and trust chains via `openssl s_client`; inspect Vault and Venafi TLS configs.                 |
| **NFR-DT2** | Data Protection in Transit     | Only **TLS 1.2 or higher** with strong ciphers may be used.                                                                        | Meets NIST SP 800-52 and enterprise crypto standards.     | Perform TLS scan; verify cipher suites and protocol versions.                                                        |
| **NFR-DT3** | Data Protection in Transit     | Vault must perform **certificate pinning or CA trust validation** for Venafi TPP endpoints.                                        | Guarantees endpoint authenticity.                         | Review PKI trust settings; confirm CA chain is validated by Vault configuration.                                     |
| **NFR-DT4** | Data Protection in Transit     | Sensitive data (API keys, tokens) must be **redacted in transit logs** and never logged in clear text.                             | Prevents credential leakage through telemetry.            | Review Vault audit logs and Venafi logs for absence of sensitive values.                                             |
| **NFR-DT5** | Data Protection in Transit     | Network connectivity between Vault and Venafi must be restricted to **approved ports (443)** via firewalls or service mesh policy. | Minimizes attack surface and isolates PKI traffic.        | Review firewall rules and network topology diagrams.                                                                 |
| **NFR-AA1** | Authentication & Authorization | Vault Agent must authenticate using **certificate-based authentication (cert auth method)**.                                       | Provides strong mutual identity assurance.                | Inspect Vault auth method configuration; confirm via `vault auth list`.                                              |
| **NFR-AA2** | Authentication & Authorization | Vault must enforce **least-privilege ACL policies** limiting roles, CNs, and domains per application.                              | Prevents unauthorized certificate issuance.               | Audit Vault policies (`vault policy read`); ensure scoped permissions.                                               |
| **NFR-AA3** | Authentication & Authorization | Venafi TPP API credentials must be **stored and rotated automatically** in Vault.                                                  | Reduces credential-reuse and stale-secret risks.          | Verify secret lease configuration and rotation policy logs.                                                          |
| **NFR-AA4** | Authentication & Authorization | Vault must integrate with **enterprise IAM (LDAP/OIDC)** for user and service-account mapping.                                     | Enables centralized identity governance.                  | Review auth backend configuration and successful test logins.                                                        |
| **NFR-AA5** | Authentication & Authorization | Vault tokens must be **short-lived** with automatic lease expiration and revocation on inactivity.                                 | Limits window for token misuse.                           | Inspect token TTL and renew policies; test token expiration.                                                         |
| **NFR-AA6** | Authentication & Authorization | Administrative access to Vault and Venafi must require **multi-factor authentication (MFA)**.                                      | Hardens privileged-access controls.                       | Confirm MFA enforcement via IAM policy or Venafi admin settings.                                                     |
| **NFR-AA7** | Authentication & Authorization | Vault policy/configuration changes must require **dual-approval or signed-commit workflow**.                                       | Provides change control and accountability.               | Review change management logs or signed configuration workflows.                                                     |
| **NFR-LG1** | Logging & Auditability         | Vault must enable **audit devices** (file, syslog, socket) to log all certificate operations.                                      | Ensures traceability of every action.                     | Check Vault audit device configuration and validate sample logs.                                                     |
| **NFR-LG2** | Logging & Auditability         | Venafi TPP must record all certificate lifecycle events (issue, renew, revoke, expiry) with identity and timestamp.                | Enables non-repudiation and compliance review.            | Validate audit reports from Venafi; confirm event completeness.                                                      |
| **NFR-LG3** | Logging & Auditability         | Audit logs must be **tamper-evident** and sent to a **centralized SIEM** (Splunk/ELK/QRadar).                                      | Prevents log alteration and supports monitoring.          | Confirm log forwarding and hash-based integrity checks.                                                              |
| **NFR-LG4** | Logging & Auditability         | Sensitive values (private keys, API tokens) must be **masked / redacted** in all logs.                                             | Avoids data leakage in audit trails.                      | Inspect logs; verify redaction of sensitive fields.                                                                  |
| **NFR-LG5** | Logging & Auditability         | Vault and Venafi logs must include **unique request IDs** to correlate certificate events end-to-end.                              | Enables full transaction traceability.                    | Match request IDs across Vault and Venafi audit logs.                                                                |
| **NFR-LG6** | Logging & Auditability         | Audit logs must be retained for at least **one year** or as per enterprise policy.                                                 | Satisfies compliance and forensic requirements.           | Review SIEM or log retention configuration and policies.                                                             |
| **NFR-LG7** | Logging & Auditability         | **Real-time alerts** must trigger on anomalies (failed auth, abnormal API rate, expired credentials).                              | Enables proactive threat detection.                       | Validate alerting rules in SIEM and test with simulated events.                                                      |

| **ID**      | **Domain**       | **Requirement Description**                                                                                                                                            | **Rationale / Compliance Objective**                                                         | **Measure / Validation Criteria**                                                                                                               |
| :---------- | :--------------- | :--------------------------------------------------------------------------------------------------------------------------------------------------------------------- | :------------------------------------------------------------------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------- |
| **NFR-SC1** | Scalability      | The Vault and Venafi integration must support **horizontal scaling** to handle increased certificate issuance and renewal loads without service degradation.           | Ensures the system can handle growth in client applications or certificate volume.           | Perform load testing to verify that latency for certificate requests remains under **2 seconds** at **2× projected peak load**.                 |
| **NFR-RS1** | Resiliency       | The system must maintain **99.9% service availability**, with automated failover for Vault clusters and Venafi TPP connections in case of node or network failure.     | Guarantees continuity of certificate lifecycle operations under component or network faults. | Verify through HA setup tests; simulate Vault node and Venafi endpoint failures to confirm automatic recovery within **60 seconds**.            |
| **NFR-IO1** | Interoperability | The Vault–Venafi integration must adhere to **standardized REST and PKI interfaces (RFC 5280, RFC 7030)**, ensuring compatibility with multiple certificate consumers. | Allows diverse applications and platforms to request and manage certificates seamlessly.     | Validate interoperability via API conformance testing and successful certificate issuance across at least **three different client platforms**. |

**System Responsibilities Table**

| **System / Component**                     | **Description**                                                                                                                                                                                        |
| ------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **Vault Agent**                            | Responsible for authenticating to Vault, requesting and renewing certificates, and securely retrieving issued certificates and private keys for local applications.                                    |
| **HashiCorp Vault**                        | Central system managing authentication, authorization, certificate storage, and policy enforcement. Forwards CSR requests to the Venafi PKI Secret Engine and returns certificates to the Vault Agent. |
| **Venafi PKI Secret Engine**               | Acts as a passthrough connector between Vault and Venafi TPP. Forwards certificate signing requests and returns signed certificates and keys securely to Vault.                                        |
| **Venafi TPP (Trust Protection Platform)** | External certificate management and policy enforcement system that generates certificates and private keys, and returns them to Vault through the PKI engine.                                          |
| **Certificate Store (in Vault)**           | Secure repository that stores certificates and private keys to prevent redundant reissuance and ensure authorized retrieval.                                                                           |
| **Vault Admin / PKI Ops Team**             | Responsible for configuring Vault’s PKI engines, authentication methods, access control policies, and maintaining operational security and compliance.                                                 |
| **Audit / Logging System**                 | Captures and retains logs of certificate operations, requests, and administrative actions for traceability and compliance reporting.                                                                   |
| **Application / Service**                  | Consumes the issued certificates and keys obtained from Vault Agent to establish secure (TLS/mTLS) communication channels.                                                                             |

**External Entities**
| **Entity Name**                               | **Type**                         | **Description**                                                                                                        | **Interaction with System (Vault)**                                                                                                                                    |
| --------------------------------------------- | -------------------------------- | ---------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Vault Agent**                               | Software Component (Client-side) | Runs on application or host system; authenticates to Vault and manages certificate lifecycle (request, renew, rotate). | • Authenticates to Vault using certificate or AppRole<br>• Sends certificate requests and renewal requests<br>• Receives issued certificates and private keys securely |
| **Venafi TPP (Trust Protection Platform)**    | External PKI System              | Enterprise-grade certificate authority that issues and manages certificates based on policy.                           | • Receives CSR forwarded by Venafi PKI Secret Engine<br>• Generates and returns certificate and private key<br>• Sends lifecycle events (renewal, revocation)          |
| **Application / Service**                     | Consumer System                  | Uses certificates and private keys issued via Vault Agent to establish secure communication.                           | • Consumes certificates delivered by Vault Agent<br>• Uses for TLS/SSL or mTLS authentication                                                                          |
| **Vault Administrator / PKI Operations Team** | Human Actor                      | Security administrators responsible for Vault configuration, PKI integration, and policy enforcement.                  | • Configures Vault policies, PKI secret engine, and auth methods<br>• Manages role-based access control and lifecycle settings                                         |
| **Audit / Logging System**                    | Monitoring System                | External SIEM or centralized logging platform for security auditing and compliance.                                    | • Receives Vault and Venafi audit logs<br>• Correlates events for compliance and security monitoring                                                                   |
| **End User (Indirect)**                       | Human User / Application Owner   | Uses an application that relies on Vault-managed certificates.                                                         | • Indirectly benefits from secure certificate lifecycle management via Vault Agent integration                                                                         |
