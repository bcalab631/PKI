# NFR Table – Vault Agent, Venafi PKI Engine & Venafi TPP

| Requirement            | Type                     | Description                                                                                                                                   | Measure                                                                 |
|------------------------|--------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------|
| **Certificate Issuance** | Availability / Performance | Venafi TPP generates certificates and key pairs. Vault Venafi PKI engine requests issuance and stores the cert/metadata in Vault. Vault Agent only fetches and injects into workloads. | SLA of Venafi TPP API ≥ 99.9% uptime. Latency ≤ 2s per issuance. Vault must persist cert until renewal. |
| **Storage**            | Security / Compliance    | Vault stores issued certs and metadata (lease, TTL) to avoid re-issuance. Private keys may also be stored depending on configuration. Vault Agent never persists, only injects. TPP stores lifecycle metadata. | Certs stored in Vault’s storage backend (encrypted). No certs/keys at rest on Vault Agent. Compliance checked via Vault audit logs. |
| **Renewal**            | Availability / Reliability | Vault Venafi PKI engine handles auto-renewal before expiry using stored lease info. Vault Agent auto-fetches the renewed cert for workloads. No need to re-issue until expiry. | Auto-renew threshold ~2/3rd of cert lifetime. Renewal success rate ≥ 99%. |
| **Expiry Handling**    | Reliability              | Venafi TPP enforces validity periods. Vault tracks TTL and requests renewal before expiry. Expired certs are replaced with new issuance via TPP. | Alerts/logs for expiry within threshold (e.g., 7 days). No expired certs injected. |
| **Revocation**         | Security / Compliance    | Revocation is executed via Venafi TPP. Vault Venafi PKI engine can trigger revocation through TPP APIs. Revoked certs appear in CRL/OCSP. Vault ensures revoked certs are not injected. | Revocation SLA ≤ 2s. Revoked cert visible in CRL/OCSP ≤ 15 min. Vault must reject revoked certs. |


Vault = broker + cache/storage

Vault Agent = injector only

Venafi TPP = issuer + system of record

| **ID**      | **Domain**                     | **Requirement Description**                                                                                                        | **Rationale / Compliance Objective**                      | **Measure / Validation Criteria**                                                                                    |
| :---------- | :----------------------------- | :--------------------------------------------------------------------------------------------------------------------------------- | :-------------------------------------------------------- | :------------------------------------------------------------------------------------------------------------------- |
| **NFR-DR1** | Data Protection at Rest        | All Vault-stored sensitive data (certificates, tokens, metadata) must be encrypted at rest using **AES-256-GCM or stronger**.      | Protects against disk compromise and unauthorized access. | Verify Vault storage encryption settings; check encryption cipher in config file or via `vault operator key-status`. |
| **NFR-DR2** | Data Protection at Rest        | Vault’s storage backend must use **auto-unseal with HSM or cloud KMS**; master keys must never be stored in plaintext.             | Ensures cryptographic key protection during startup.      | Validate HSM/KMS integration via Vault config; review unseal process and audit logs.                                 |
| **NFR-DR3** | Data Protection at Rest        | Venafi TPP must store private keys in its **secure keystore / HSM**; plaintext storage is prohibited.                              | Maintains confidentiality of private keys.                | Review Venafi key storage configuration and HSM integration reports.                                                 |
| **NFR-DR4** | Data Protection at Rest        | Vault data storage nodes must be protected via **RBAC and network segmentation**.                                                  | Reduces insider and lateral-movement risks.               | Validate network ACLs and user access lists; perform periodic access audits.                                         |
| **NFR-DR5** | Data Protection at Rest        | Backups of Vault and Venafi data must be encrypted using enterprise-approved algorithms.                                           | Preserves data confidentiality in archives.               | Check backup encryption configuration and verify restore sample with encryption intact.                              |
| **NFR-DT1** | Data Protection in Transit     | All communication between Vault Agent ↔ Vault Server ↔ Venafi TPP must use **mutual TLS (mTLS)**.                                  | Prevents MITM and spoofing attacks.                       | Validate certificates and trust chains via `openssl s_client`; inspect Vault and Venafi TLS configs.                 |
| **NFR-DT2** | Data Protection in Transit     | Only **TLS 1.2 or higher** with strong ciphers may be used.                                                                        | Meets NIST SP 800-52 and enterprise crypto standards.     | Perform TLS scan; verify cipher suites and protocol versions.                                                        |
| **NFR-DT3** | Data Protection in Transit     | Vault must perform **certificate pinning or CA trust validation** for Venafi TPP endpoints.                                        | Guarantees endpoint authenticity.                         | Review PKI trust settings; confirm CA chain is validated by Vault configuration.                                     |
| **NFR-DT4** | Data Protection in Transit     | Sensitive data (API keys, tokens) must be **redacted in transit logs** and never logged in clear text.                             | Prevents credential leakage through telemetry.            | Review Vault audit logs and Venafi logs for absence of sensitive values.                                             |
| **NFR-DT5** | Data Protection in Transit     | Network connectivity between Vault and Venafi must be restricted to **approved ports (443)** via firewalls or service mesh policy. | Minimizes attack surface and isolates PKI traffic.        | Review firewall rules and network topology diagrams.                                                                 |
| **NFR-AA1** | Authentication & Authorization | Vault Agent must authenticate using **certificate-based authentication (cert auth method)**.                                       | Provides strong mutual identity assurance.                | Inspect Vault auth method configuration; confirm via `vault auth list`.                                              |
| **NFR-AA2** | Authentication & Authorization | Vault must enforce **least-privilege ACL policies** limiting roles, CNs, and domains per application.                              | Prevents unauthorized certificate issuance.               | Audit Vault policies (`vault policy read`); ensure scoped permissions.                                               |
| **NFR-AA3** | Authentication & Authorization | Venafi TPP API credentials must be **stored and rotated automatically** in Vault.                                                  | Reduces credential-reuse and stale-secret risks.          | Verify secret lease configuration and rotation policy logs.                                                          |
| **NFR-AA4** | Authentication & Authorization | Vault must integrate with **enterprise IAM (LDAP/OIDC)** for user and service-account mapping.                                     | Enables centralized identity governance.                  | Review auth backend configuration and successful test logins.                                                        |
| **NFR-AA5** | Authentication & Authorization | Vault tokens must be **short-lived** with automatic lease expiration and revocation on inactivity.                                 | Limits window for token misuse.                           | Inspect token TTL and renew policies; test token expiration.                                                         |
| **NFR-AA6** | Authentication & Authorization | Administrative access to Vault and Venafi must require **multi-factor authentication (MFA)**.                                      | Hardens privileged-access controls.                       | Confirm MFA enforcement via IAM policy or Venafi admin settings.                                                     |
| **NFR-AA7** | Authentication & Authorization | Vault policy/configuration changes must require **dual-approval or signed-commit workflow**.                                       | Provides change control and accountability.               | Review change management logs or signed configuration workflows.                                                     |
| **NFR-LG1** | Logging & Auditability         | Vault must enable **audit devices** (file, syslog, socket) to log all certificate operations.                                      | Ensures traceability of every action.                     | Check Vault audit device configuration and validate sample logs.                                                     |
| **NFR-LG2** | Logging & Auditability         | Venafi TPP must record all certificate lifecycle events (issue, renew, revoke, expiry) with identity and timestamp.                | Enables non-repudiation and compliance review.            | Validate audit reports from Venafi; confirm event completeness.                                                      |
| **NFR-LG3** | Logging & Auditability         | Audit logs must be **tamper-evident** and sent to a **centralized SIEM** (Splunk/ELK/QRadar).                                      | Prevents log alteration and supports monitoring.          | Confirm log forwarding and hash-based integrity checks.                                                              |
| **NFR-LG4** | Logging & Auditability         | Sensitive values (private keys, API tokens) must be **masked / redacted** in all logs.                                             | Avoids data leakage in audit trails.                      | Inspect logs; verify redaction of sensitive fields.                                                                  |
| **NFR-LG5** | Logging & Auditability         | Vault and Venafi logs must include **unique request IDs** to correlate certificate events end-to-end.                              | Enables full transaction traceability.                    | Match request IDs across Vault and Venafi audit logs.                                                                |
| **NFR-LG6** | Logging & Auditability         | Audit logs must be retained for at least **one year** or as per enterprise policy.                                                 | Satisfies compliance and forensic requirements.           | Review SIEM or log retention configuration and policies.                                                             |
| **NFR-LG7** | Logging & Auditability         | **Real-time alerts** must trigger on anomalies (failed auth, abnormal API rate, expired credentials).                              | Enables proactive threat detection.                       | Validate alerting rules in SIEM and test with simulated events.                                                      |

